  map.addListener('idle', function() {
    const bounds = map.getBounds();
      <% @heritages.each do |heritage|%>
        <% if !heritage.lat.nil? %>
          var heritageLatLng = new google.maps.LatLng(<%= heritage.lat %>, <%= heritage.lng %>);
          var isVisible = bounds.contains(heritageLatLng);
          var heritageCard = document.getElementById(`heritage-<%= heritage.id %>`);
          if (isVisible) {
            const heritageTag = document.createElement("a");
            heritageTag.className = "heritage-pin";
            heritageTag.href = `#heritage-<%= heritage.id %>`;
            heritageTag.textContent = `<%= heritage.name %>  ⭐︎<%= calc_average_review_score(heritage.id) %>`;
            const markerLatLng = { lat: <%= heritage.lat %>, lng: <%= heritage.lng %> };
            const markerView = new google.maps.marker.AdvancedMarkerView({
              map,
              position: markerLatLng,
              content: heritageTag,
            });
            markerView.addListener('click', function() {
              const allHeritageCards = document.querySelectorAll('.area-heritage-card');
              // クリックされた以外のカードをすべて非表示
              allHeritageCards.forEach(card => {
                card.classList.remove('heritage-card-show');
              });
              // クリックされたカードのみ表示
              heritageCard.classList.add("heritage-card-show");
            });
            heritageCard.classList.add("area-heritage-card-show");
          } else {
            heritageCard.classList.remove("area-heritage-card-show");
          }
        <% end %>
      <% end %>
  });
}
window.initMap = initMap;